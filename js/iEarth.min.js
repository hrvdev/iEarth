!function(a){var b=function(){var b=a.localStorage;return{getItem:function(a){return b.getItem(a)},setItem:function(a,c){b.removeItem(a),b.setItem(a,c)},removeItem:function(a){b.removeItem(a)}}}(),c=function(){function a(a,b){for(var c in b)a[c]=b[c]}function b(a){return a+"_"+Date.now()+"_"+Math.random()}function c(a){var b,c,d,e,f,g=new Date(1e3*a),h=new Date,i=h-g;return 36e5>i?f=0==Math.ceil(i/216e3)?"刚刚":Math.ceil(i/216e3).toString()+"分钟前":(b=g.getHours(),c=g.getMinutes(),d=10>b?"0"+b.toString():b.toString(),e=10>c?"0"+c.toString():c.toString(),f=h.getFullYear()===g.getFullYear()?h.getDate()===g.getDate()?"今天"+d+":"+e:(g.getMonth()+1).toString()+"月"+g.getDate().toString()+"日 "+d+":"+e:g.getFullYear().toString()+"年 "+(g.getMonth()+1).toString()+"月"+g.getDate().toString()+"日 "+d+":"+e),f}return{extend:a,uuid:b,readableDate:c}}(),d=(function(){var a=function(){this.listener={}};return a.prototype.addListener=function(a,b){this.listener[a]||(this.listener[a]=[]),this.listener[a].push(b)},a.prototype.fire=function(a){var b=this.listener[a];if(b&&b.length)for(var c=0;c<b.length;c++)b[c]()},a}(),function(){this.dom=$("#mapEditor"),this.mapEditorTitle=$("#mapEditorTitle"),this.mapEditorInput=$("#mapEditorInput"),this._bindEvent()});c.extend(d.prototype,{_bindEvent:function(){var a=this;a.dom.on("click",".layer-manager-close",function(){a._hide()}).on("click",".layer-manager-btn.cancel",function(){a._hide()}).on("click",".layer-manager-btn.ok",function(){if(a.callback){var b=a.mapEditorInput.val().trim()||"未命名的地图";a.callback(b)}a._hide()})},_reset:function(a){this.mapEditorInput.val(a)},_show:function(){var b=a.innerWidth,c=a.innerHeight;this.dom.css("left",(b-402)/2).css("top",(c-172)/2),this.dom.fadeIn(100)},_hide:function(){this.dom.fadeOut(100)},createMap:function(a){this._reset(""),this.mapEditorTitle.html("创建地图"),this.callback=a,this._show()},editMap:function(a,b){this._reset(a),this.mapEditorTitle.html("修改地图标题"),this.callback=b,this._show()}});var e=function(){var a="ALL_MAP",d="MAP_",e="LAST_MAP",f="MAP_ID",g=function(){this.allMaps=[];var c=b.getItem(a);c&&(this.allMaps=JSON.parse(c))};return c.extend(g.prototype,{getLastEditMap:function(){var a=b.getItem(e);return this.currentEditMap=a?this.getMap(a):this.createDefaultMap(),this.currentEditMap},setDefaultMap:function(a){b.setItem(e,a)},createDefaultMap:function(){var a=this.addMap("未命名的地图");return this.setDefaultMap(a.id),a},getMap:function(a){return JSON.parse(b.getItem(d+a))},addMap:function(e){var g={id:c.uuid(f),name:e,ctime:Date.now(),layerList:[]};return this.allMaps.splice(0,0,g.id),b.setItem(a,JSON.stringify(this.allMaps)),b.setItem(d+g.id,JSON.stringify(g)),g},updateMap:function(a){b.setItem(d+a.id,JSON.stringify(a))},addLayerToMap:function(){},addObjectToLayer:function(){},removeMap:function(){},removeLayer:function(){},removeObject:function(){},getAllMaps:function(){for(var a=[],b=0;b<this.allMaps.length;b++)a.push(this.getMap(this.allMaps[b]));return a}}),g}(),f=function(){var b=function(a){this.dataController=a,this.htmlGenerator=_.template($("#mapListTemplate").html()),this.dom=$("#layerManager"),this.mapListC=$("#mapListC"),this.dom.find(".layer-manager-btn.ok").addClass("disable"),this._bindEvent()};return c.extend(b.prototype,{_bindEvent:function(){var a=this;a.dom.on("click",".layer-manager-close",function(){a._hide()}).on("click",".layer-manager-btn.cancel",function(){a._hide()}).on("click",".layer-manager-row",function(){a.mapListC.find(".layer-manager-row").removeClass("selected"),$(this).addClass("selected"),a.selectedIndex=$(this).index(),a.dom.find(".layer-manager-btn.ok").removeClass("disable")}).on("click",".layer-manager-btn.ok",function(){$(this).hasClass("disable")||(a.callback(a.maps[a.selectedIndex]),a._hide())})},_show:function(){var b=a.innerWidth,c=a.innerHeight;this.dom.css("left",(b-702)/2).css("top",(c-502)/2),this.dom.fadeIn(100)},_hide:function(){this.dom.fadeOut(100)},_fillHTML:function(){for(var a=0;a<this.maps.length;a++)this.maps[a].timeStr=c.readableDate(this.maps[a].ctime/1e3);this.mapListC.html(this.htmlGenerator({maps:this.maps}))},openMap:function(a){this.callback=a,this.maps=this.dataController.getAllMaps(),this._fillHTML(),this._show()}}),b}(),g=function(){var a=function(){this.dom=$("#mapManager"),this.mapTitle=$("#mapTitle"),this.mapOperations=$("#mapOperations"),this.mapLayerList=$("#mapLayerList"),this.mapEditor=new d,this.layerListDataController=new e,this.layerListViewController=new f(this.layerListDataController),this.mapLayerListRender=_.template($("#mapLayerListTemplate").html()),this._bindEvent()};return c.extend(a.prototype,{_bindEvent:function(){var a=this;a.mapLayerList.on("click",".layer-list-manager-layer-t",function(){$(a.mapLayerList.find(".layer-list-manager-layer")[a.currentLayerIndex]).removeClass("selected"),a.currentLayerIndex=$(this).attr("data-index"),$(a.mapLayerList.find(".layer-list-manager-layer")[a.currentLayerIndex]).addClass("selected"),$(this).parent().hasClass("hide-content")&&$(this).parent().removeClass("hide-content")}).on("click",".checkbox",function(b){$(this).parent().parent().toggleClass("hide-content"),$(this).parent().parent().hasClass("hide-content")||($(a.mapLayerList.find(".layer-list-manager-layer")[a.currentLayerIndex]).removeClass("selected"),a.currentLayerIndex=$(this).attr("data-index"),$(a.mapLayerList.find(".layer-list-manager-layer")[a.currentLayerIndex]).addClass("selected")),b.stopPropagation()}),$(".layer-list-manager-bar").on("click",".operations",function(){a.mapOperations.toggle()}).on("click",".add-layer",function(){$(a.mapLayerList.find(".layer-list-manager-layer")[a.currentLayerIndex]).removeClass("selected"),a.currentLayerIndex=a.layers.length;var b={name:"未命名的图层",objectList:[]};a.mapLayerList.append(a.mapLayerListRender({layers:[b],fromIndex:a.layers.length})),a.layers.push(b),a.mapObject.layerList=a.layers,$(a.mapLayerList.find(".layer-list-manager-layer")[a.currentLayerIndex]).addClass("selected").removeClass("hide-content"),a.layerListDataController.updateMap(a.mapObject)}),a.mapOperations.on("click",".create",function(){a.mapOperations.hide(),a.mapEditor.createMap(function(b){a.showMap(a.layerListDataController.addMap(b))})}).on("click",".open",function(){a.mapOperations.hide(),a.layerListViewController.openMap(function(b){a.layerListDataController.setDefaultMap(b.id),a.showMap(b)})}).on("click",".delete",function(){a.mapOperations.hide(),a.layerListDataController.removeMap($(this).attr("data-mapId"))}),a.mapTitle.on("click",function(){a.mapEditor.editMap(a.mapObject.name,function(b){a.mapObject.name=b,a.mapTitle.text(b),a.layerListDataController.updateMap(a.mapObject)})})},_fillHTML:function(){this.mapTitle.html(this.mapObject.name),this.mapLayerList.html(this.mapLayerListRender({layers:this.layers,fromIndex:0}))},showMap:function(a){this.currentLayerIndex=0,this.mapObject=a,this.layers=a.layerList,this._fillHTML(),this.dom.fadeIn(100)},start:function(){var a=this.layerListDataController.getLastEditMap();this.showMap(a)}}),a}(),h=new g;h.start()}(window,document);
//# sourceMappingURL=iEarth.map
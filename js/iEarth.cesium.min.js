!function(a,b){var c=function(){function a(b,c){if(null==b||"object"!=typeof b)return b;if(b.constructor!=Object&&b.constructor!=Array)return b;if(b.constructor==Date||b.constructor==RegExp||b.constructor==Function||b.constructor==String||b.constructor==Number||b.constructor==Boolean)return new b.constructor(b);c=c||new b.constructor;for(var d in b)c[d]="undefined"==typeof c[d]?a(b[d],null):c[d];return c}function b(b,c){b=b||{};var d;for(d in c)void 0===b[d]&&(b[d]=a(c[d]))}function c(a){var b=0|a,c=Math.abs(a-b),d=60*c|0,e=3600*c-60*d;return b+" "+d.toFixed(3)+"' "+e.toFixed(3)+'"'}function d(b,c){var d,e=a(b);for(d in c)void 0===e[d]&&(e[d]=a(c[d]));return e}function e(a,b){var c,d,e=q.cartesianArrayToCartographicArray(a),f=[];for(c=0;c<e.length-1;c++){d=new Cesium.EllipsoidGeodesic(e[c],e[c+1]);for(var g=d.getSurfaceDistance(),h=0;g>h;h+=b)f.push(d.interpolateUsingSurfaceDistance(h))}return f.push(e[e.length-1]),q.cartographicArrayToCartesianArray(f)}function f(a,b,c){a[b]=c}function g(a){a._listeners={},a.addListener=function(a,b){return this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b),this._listeners[a].length},a.executeListeners=function(a,b){if(this._listeners[a.name]&&this._listeners[a.name].length>0)for(var c=0;c<this._listeners[a.name].length;c++)this._listeners[a.name][c](a);else b&&b(a)}}function h(a){return a+"_"+Date.now()+"_"+Math.random()}function i(a,b){var c=q.cartesianToCartographic(a);return{longitude:Cesium.Math.toDegrees(c.longitude).toFixed(b),latitude:Cesium.Math.toDegrees(c.latitude).toFixed(b)}}function j(a){for(var b=Math.floor(a),c=a-b,d=[];b>0;)d.push(b%1e3+""),b=(b-b%1e3)/1e3;return d.reverse().join(",")+(c.toFixed(2)+"").substring(1,4)}function k(a,b,c,d,e){var f=Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2));return"m"==e?j(f)+"m":"km"==e?j(f/1e3)+"km":f}function l(a,b){if(!a.length||1==a.length)return 0;for(var c,d,e=0,f=1;f<a.length;f++)c=a[f-1],d=a[f],e+=Math.sqrt(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2));return"m"==b?j(e)+"m":"km"==b?j(e/1e3)+"km":e}function m(a){return"[object Number]"===r.call(a)}function n(a){return"[object String]"===r.call(a)}function o(a){return n(a)?w[a]?!0:s.test(a)||t.test(a)||u.test(a)||v.test(a):!1}function p(a){if(n(a)){var b;if(s.test(a)){var c=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a);return{r:Math.min(255,parseInt(c[1],10))/255,g:Math.min(255,parseInt(c[2],10))/255,b:Math.min(255,parseInt(c[3],10))/255}}if(t.test(a)){var c=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a);return{r:Math.min(100,parseInt(c[1],10))/100,g:Math.min(100,parseInt(c[2],10))/100,b:Math.min(100,parseInt(c[3],10))/100}}if(u.test(a)){var c=/^\#([0-9a-f]{6})$/i.exec(a);b=parseInt(c[1],16)}else if(v.test(a)){var c=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a);b=parseInt(c[1]+c[1]+c[2]+c[2]+c[3]+c[3],16)}else w[a]&&(b=w[a]);if(b){var d=Math.floor(b);return{r:(d>>16&255)/255,g:(d>>8&255)/255,b:(255&d)/255}}}}var q=Cesium.Ellipsoid.WGS84,r=Object.prototype.toString,s=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i,t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i,u=/^\#([0-9a-f]{6})$/i,v=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i,w={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};return{uuid:h,clone:a,fillOptions:b,copyOptions:d,getGeodesicPath:e,setListener:f,enhanceWithListeners:g,cartesian2Coord:i,calDistance:k,getTotalDistance:l,isNumber:m,isString:n,isColor:o,getColor:p,convertDDToDMS:c}}(),d=function(){var a=Cesium.Material.fromType(Cesium.Material.ColorType);a.uniforms.color=new Cesium.Color(1,1,0,.5);var b=Cesium.Material.fromType(Cesium.Material.ColorType);b.uniforms.color=new Cesium.Color(0,1,0,1);var d={ellipsoid:Cesium.Ellipsoid.WGS84,textureRotationAngle:0,height:0,asynchronous:!0,show:!0,debugShowBoundingVolume:!1},e=c.copyOptions(d,{appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!1}),material:a,granularity:Math.PI/180}),f=Cesium.Material.fromType(Cesium.Material.ColorType);f.uniforms.color=new Cesium.Color(1,0,0,.9);var g=c.copyOptions(d,{material:f,extrudedHeight:0,appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!1}),granularity:Math.PI/180}),h=(c.copyOptions(d,{}),Cesium.Material.fromType(Cesium.Material.ColorType));h.uniforms.color=new Cesium.Color(1,1,0,.9);var i=c.copyOptions(d,{appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!1}),material:h,granularity:Math.PI/180,extrudedHeight:0}),j=c.copyOptions(e,{rotation:0}),k=Cesium.Material.fromType(Cesium.Material.ColorType);k.uniforms.color=new Cesium.Color(0,0,0,1);var l=c.copyOptions(d,{width:2,geodesic:!0,granularity:1e4,appearance:new Cesium.PolylineMaterialAppearance({aboveGround:!1}),material:k}),m=Cesium.Material.fromType(Cesium.Material.PolylineArrowType);m.uniforms.color=new Cesium.Color(1,1,0,.7);var n=c.copyOptions(d,{width:10,geodesic:!0,granularity:1e4,appearance:new Cesium.PolylineMaterialAppearance({aboveGround:!1}),material:m}),o=Cesium.Material.fromType(Cesium.Material.ColorType);o.uniforms.color=new Cesium.Color(0,1,0,.5);var p=c.copyOptions(d,{width:2,geodesic:!0,granularity:1e4,appearance:new Cesium.PolylineMaterialAppearance({aboveGround:!1}),material:o}),q=c.copyOptions(d,{width:2,geodesic:!0,granularity:1e4,appearance:new Cesium.PolylineMaterialAppearance({aboveGround:!1}),material:b}),r={iconUrl:"./imgs/dragIcon.png",shiftX:0,shiftY:0},s={iconUrl:"./imgs/dragIcon.png",shiftX:0,shiftY:0},t={iconUrl:"./imgs/dragIconLight.png",shiftX:0,shiftY:0},u={font:{height:16},fillColor:"#ffffff",scale:1},v={positions:[],color:"blue",width:5};return{material:a,defaultShapeOptions:d,defaultSurfaceOptions:e,defaultPolygonOptions:g,defaultCircleOptions:i,defaultEllipseOptions:j,defaultPolylineOptions:function(){return l},defaultDrawingArrowOptions:n,defaultBillboard:r,dragBillboard:s,dragHalfBillboard:t,defaultLabelOptions:function(){return u},defaultArrowOptions:v,defaultMeasurePolylineOptions:p,defaultRadiusPolylineOptions:q,setDefaultLabel:function(a,b){u.font.height=a,u.fillColor=b},setDefaultPolyline:function(a,b){var e=Cesium.Material.fromType(Cesium.Material.ColorType);e.uniforms.color=new Cesium.Color(b.r/255,b.g/255,b.b/255,1),l=c.copyOptions(d,{width:a,geodesic:!0,granularity:1e4,appearance:new Cesium.PolylineMaterialAppearance({aboveGround:!1}),material:e})},createPolyline:function(a,b){var e=Cesium.Material.fromType(Cesium.Material.ColorType);e.uniforms.color=new Cesium.Color(b.red,b.green,b.blue,1);var f=c.copyOptions(d,{width:a,geodesic:!0,granularity:1e4,appearance:new Cesium.PolylineMaterialAppearance({aboveGround:!1}),material:e});return f}}}();window.CesiumDefault=d;var e=function(){function a(){}return a.prototype.initialiseOptions=function(a){c.fillOptions(this,a),this._ellipsoid=void 0,this._granularity=void 0,this._height=void 0,this._textureRotationAngle=void 0,this._id=void 0,this._createPrimitive=!0,this._primitive=void 0,this._outlinePolygon=void 0},a.prototype.setAttribute=function(a,b){this[a]=b,this._createPrimitive=!0},a.prototype.getAttribute=function(a){return this[a]},a.prototype.update=function(a,b,c){if(!Cesium.defined(this.ellipsoid))throw new Cesium.DeveloperError("this.ellipsoid must be defined.");if(!Cesium.defined(this.appearance))throw new Cesium.DeveloperError("this.material must be defined.");if(this.granularity<0)throw new Cesium.DeveloperError("this.granularity and scene2D/scene3D overrides must be greater than zero.");if(this.show&&(this._createPrimitive||Cesium.defined(this._primitive))){if(this._createPrimitive||this._ellipsoid!==this.ellipsoid||this._granularity!==this.granularity||this._height!==this.height||this._textureRotationAngle!==this.textureRotationAngle||this._id!==this.id){var d=this.getGeometry();if(!d)return;this._createPrimitive=!1,this._ellipsoid=this.ellipsoid,this._granularity=this.granularity,this._height=this.height,this._textureRotationAngle=this.textureRotationAngle,this._id=this.id,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:d,id:this.id,pickPrimitive:this}),appearance:this.appearance,asynchronous:this.asynchronous}),this._outlinePolygon=this._outlinePolygon&&this._outlinePolygon.destroy(),this.strokeColor&&this.getOutlineGeometry&&(this._outlinePolygon=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:this.getOutlineGeometry(),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)}}),appearance:new Cesium.PerInstanceColorAppearance({flat:!0,renderState:{depthTest:{enabled:!0},lineWidth:Math.min(this.strokeWidth||4,a.getMaximumAliasedLineWidth())}})}))}var e=this._primitive;e.appearance.material=this.material,e.debugShowBoundingVolume=this.debugShowBoundingVolume,e.update(a,b,c),this._outlinePolygon&&this._outlinePolygon.update(a,b,c)}},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Cesium.destroyObject(this)},a.prototype.setStrokeStyle=function(a,b){this.strokeColor&&this.strokeColor.equals(a)&&this.strokeWidth==b||(this._createPrimitive=!0,this.strokeColor=a,this.strokeWidth=b)},a}(),f=function(){var a=Cesium.Ellipsoid.WGS84,b=function(a){a=c.copyOptions(a,d.defaultLabelOptions()),c.fillOptions(this,a);var b=new Cesium.LabelCollection,e=a.font||{},f=(e.height||12)+"px "+(e.name||"Helvetica"),g=b.add({position:a.position,text:a.text,font:f,fillColor:Cesium.Color.fromCssColorString(a.fillColor),style:Cesium.LabelStyle.FILL,scale:a.scale});this.primitive=b,this.label=g};return b.prototype.getPrimitive=function(){return this.primitive},b.prototype.getExtent=function(){var b=this.label.getPosition(),c={};c.x=b.x+100,c.y=b.y+100,c.z=b.z;var d={};d.x=b.x+100,d.y=b.y-100,d.z=b.z;var e={};e.x=b.x-100,e.y=b.y+100,e.z=b.z;var f={};return f.x=b.x-100,f.y=b.y-100,f.z=b.z,Cesium.Extent.fromCartographicArray(a.cartesianArrayToCartographicArray([c,d,e,f]))},b}(),g=function(){var a=Cesium.Ellipsoid.WGS84,b=function(a,b){this._cesiumEditor=a,this._scene=a._scene,this._options=c.copyOptions(b,d.defaultBillboard);var e=new Cesium.BillboardCollection,f=this._scene.context.createTextureAtlas();e.textureAtlas=f,this._scene.primitives.add(e),this._billboards=e,this._textureAtlas=f,this._orderedBillboards=[];var g=new Image;g.onload=function(){f.addImage(g)},g.src=b.iconUrl};return b.prototype.createBillboard=function(b,d){function e(a){i.enableRotate=a}function f(){for(var a=0,b=h._orderedBillboards.length;b>a&&h._orderedBillboards[a]!=g;++a);return a}var g=this._billboards.add({show:!0,position:b,pixelOffset:new Cesium.Cartesian2(this._options.shiftX,this._options.shiftY),eyeOffset:new Cesium.Cartesian3(0,0,0),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.CENTER,scale:1,imageIndex:0,color:new Cesium.Color(1,1,1,1)});if(d){var h=this,i=this._scene.screenSpaceCameraController;d.dragHandlers&&c.setListener(g,"leftDown",function(b){function c(a){g.setPosition(a),d.dragHandlers.onDrag&&d.dragHandlers.onDrag(f(),a)}function i(a){j.destroy(),e(!0),d.dragHandlers.onDragEnd&&d.dragHandlers.onDragEnd(f(),a)}e(!1);var j=new Cesium.ScreenSpaceEventHandler(h._scene.canvas);j.setInputAction(function(b){var d=h._scene.camera.pickEllipsoid(b.endPosition,a);d?c(d):i(d)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),j.setInputAction(function(b){i(h._scene.camera.pickEllipsoid(b.position,a))},Cesium.ScreenSpaceEventType.LEFT_UP),d.dragHandlers.onDragStart&&d.dragHandlers.onDragStart(f(),h._scene.camera.pickEllipsoid(b,a))}),d.onOutHandlers&&(c.setListener(g,"mouseMove",function(a){d.onOutHandlers.onMouseOn&&d.onOutHandlers.onMouseOn(f(),a)}),c.setListener(g,"mouseOut",function(){d.onOutHandlers.onMouseOut&&d.onOutHandlers.onMouseOut()}))}return g},b.prototype.addBillboard=function(a,b){this._orderedBillboards.push(this.createBillboard(a,b))},b.prototype.getBillboard=function(a){return this._orderedBillboards[a]},b.prototype.addBillboards=function(a,b){for(var c=0;c<a.length;c++)this.addBillboard(a[c],b)},b.prototype.countBillboards=function(){return this._orderedBillboards.length},b.prototype.insertBillboard=function(a,b,c){this._orderedBillboards.splice(a,0,this.createBillboard(b,c))},b.prototype.setOnTop=function(){this._scene.primitives.raiseToTop(this._billboards)},b.prototype.updateBillboardsPositions=function(a){for(var b=0;b<a.length;b++)this.getBillboard(b).setPosition(a[b])},b.prototype.remove=function(){this._billboards=this._billboards&&this._billboards.removeAll()&&this._billboards.destroy()},b}(),h=function(){function a(a){a=c.copyOptions(a,d.defaultSurfaceOptions),this.initialiseOptions(a)}return a.prototype=new e,a.prototype.setPositions=function(a){this.setAttribute("positions",a)},a.prototype.setWidth=function(a){this.setAttribute("width",a)},a.prototype.setGeodesic=function(a){this.setAttribute("geodesic",a)},a.prototype.setOutlineProperty=function(a){this.setAttribute("material",a)},a.prototype.getPositions=function(){return this.getAttribute("positions")},a.prototype.getWidth=function(){return this.getAttribute("width")},a.prototype.getGeodesic=function(){return this.getAttribute("geodesic")},a.prototype.getGeometry=function(){return!Cesium.defined(this.positions)||this.positions.length<2?void 0:new Cesium.PolylineGeometry({positions:this.geodesic?c.getGeodesicPath(this.positions,Math.max(this.granularity,5e4)):this.positions,height:this.height,width:this.width<1?1:this.width,vertexFormat:Cesium.PolylineMaterialAppearance.VERTEX_FORMAT,ellipsoid:this.ellipsoid})},a.prototype.getExtent=function(){return Cesium.Extent.fromCartographicArray(this.ellipsoid.cartesianArrayToCartographicArray(this.getPositions()))},a}(),i=function(){var a=Cesium.Ellipsoid.WGS84,b=function(){var a=window.cesiumViewer.cesiumWidget;this.cesiumViewer=window.cesiumViewer,this._scene=a.scene,this._surfaces=[],this.primitivesCache={},this.initialiseHandlers(),this.enhancePrimitives(),this.listeners={},this.idGenerator=0};return b.prototype.disableMouseEvent=function(){var a=this._scene;a.screenSpaceCameraController.enableRotate=!1,a.screenSpaceCameraController.enableTranslate=!1,a.screenSpaceCameraController.enableZoom=!1,a.screenSpaceCameraController.enableTilt=!1,a.screenSpaceCameraController.enableLook=!1},b.prototype.enableMouseEvent=function(){var a=this._scene;a.screenSpaceCameraController.enableRotate=!0,a.screenSpaceCameraController.enableTranslate=!0,a.screenSpaceCameraController.enableZoom=!0,a.screenSpaceCameraController.enableTilt=!0,a.screenSpaceCameraController.enableLook=!0},b.prototype.nextID=function(){return"CesiumEditor_id_"+c.uuid("ce")},b.prototype.addListener=function(a,b,c){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push({callback:b,context:c})},b.prototype.trigger=function(a,b){var c=this.listeners[a];if(c)for(var d=0,e=c.length;e>d;d++)c[d].callback.call(c[d].context,b)},b.prototype.initialiseHandlers=function(){function a(a,d){if(1!=c._handlersMuted){var e=b.pick(d);e&&e.primitive&&e.primitive[a]?e.primitive[a](d):e&&e.collection&&e.collection[a]&&e.collection[a](d)}}var b=this._scene,c=this,d=new Cesium.ScreenSpaceEventHandler(b.canvas);d.setInputAction(function(b){a("leftClick",b.position)},Cesium.ScreenSpaceEventType.LEFT_CLICK);var e;d.setInputAction(function(a){if(1!=c._handlersMuted){var d=b.pick(a.endPosition);!e||d&&e==d.primitive||(!(e.isDestroyed&&e.isDestroyed())&&e.mouseOut(a.endPosition),e=null),d&&d.primitive&&(d=d.primitive,d.mouseOut&&(e=d),d.mouseMove&&d.mouseMove(a.endPosition))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),d.setInputAction(function(b){a("leftDoubleClick",b.position)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),d.setInputAction(function(b){a("leftUp",b.position)},Cesium.ScreenSpaceEventType.LEFT_UP),d.setInputAction(function(b){a("leftDown",b.position)},Cesium.ScreenSpaceEventType.LEFT_DOWN)},b.prototype.disableAllHighlights=function(){this.setHighlighted(void 0)},b.prototype.setHighlighted=function(a){this._highlightedSurface&&!this._highlightedSurface.isDestroyed()&&this._highlightedSurface!=a&&this._highlightedSurface.setHighlighted(!1),this._highlightedSurface=a},b.prototype.disableAllEditMode=function(){this.setEdited(void 0)},b.prototype.setEdited=function(a){this._editedSurface&&!this._editedSurface.isDestroyed()&&this._editedSurface.setEditMode(!1),this._editedSurface=a},b.prototype.registerEditableShape=function(a){var b=this;c.setListener(a,"mouseMove",function(){a.setHighlighted(!0)}),c.setListener(a,"mouseOut",function(){b.disableAllHighlights()}),c.setListener(a,"leftClick",function(){a.setEditMode(!0),a.id&&b.trigger("willEdit",a.id)})},b.prototype.enhancePrimitives=function(){function b(b){function c(){j.executeListeners({name:"onEdited",positions:j.getPositions()})}function f(a,b){var c=0>a-1?b.length-1:a-1;c<l.countBillboards()&&l.getBillboard(c).setPosition(h(c)),c=a,c<l.countBillboards()&&l.getBillboard(c).setPosition(h(c))}function h(b){return m=j.getPositions(),a.scaleToGeodeticSurface(Cesium.Cartesian3.lerp(m[b],m[b<m.length-1?b+1:0],.5))}if(this._editMode!=b)if(e.disableAllHighlights(),b){e.setEdited(this);var i=e._scene,j=this;if(null==j._markers){var k=new g(e,d.dragBillboard),l=new g(e,d.dragHalfBillboard),m=j.getPositions(),n={dragHandlers:{onDrag:function(a,b){m=j.getPositions(),m[a]=b,j.setPositions(m),f(a,m)},onDragEnd:function(){c()}}};k.addBillboards(m,n),j._markers=k;for(var o={dragHandlers:{onDragStart:function(a,b){m=j.getPositions(),this.index=a+1,m.splice(this.index,0,b),j.setPositions(m)},onDrag:function(a,b){m=j.getPositions(),m[this.index]=b,j.setPositions(m)},onDragEnd:function(a,b){k.insertBillboard(this.index,b,n),l.getBillboard(this.index-1).setPosition(h(this.index-1)),l.insertBillboard(this.index,h(this.index),o),c()}}},p=[],q=0,r=m.length-1;r>q;q++)p.push(h(q));l.addBillboards(p,o),j._editMarkers=l,this._globeClickhandler=new Cesium.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(a){var b=i.pick(a.position);b&&b.primitive||j.setEditMode(!1)},Cesium.ScreenSpaceEventType.LEFT_CLICK),k.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._editMarkers.remove(),this._editMarkers=null,this._globeClickhandler.destroy()),this._editMode=!1}var e=this;f.prototype.setEditable=function(){if(!this.setEditMode){var a=this,b=this.label,f=e._scene;b.id=a.id,e.registerEditableShape(b),b.setEditMode=function(b){if(this._editMode!=b)if(e.disableAllHighlights(),b){e.setEdited(this);var c=this;if(null==this._markers){var h=new g(e,d.dragBillboard),i={dragHandlers:{onDrag:function(a,b){c.setPosition(b)},onDragEnd:function(b,c){e.trigger("edited",{id:a.id,position:c})}}};h.addBillboards([this.getPosition()],i),this._markers=h,this._globeClickhandler=new Cesium.ScreenSpaceEventHandler(f.canvas),this._globeClickhandler.setInputAction(function(a){var b=f.pick(a.position);b&&b.primitive||c.setEditMode(!1)},Cesium.ScreenSpaceEventType.LEFT_CLICK),h.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1};{b.getOutlineWidth(),b.getScale()}b.setHighlighted=function(a){e._scene;this._highlighted&&this._highlighted==a||this._editMode!==!0&&(this._highlighted=a,a?(e.setHighlighted(this),this.setOutlineWidth(2*this.getOutlineWidth()),this.setScale(this.getScale()+.2)):(this.setOutlineWidth(this.getOutlineWidth()/2),this.setScale(this.getScale()-.2)))},c.enhanceWithListeners(b),b.setEditMode(!1)}},Cesium.Billboard.prototype.setEditable=function(){},h.prototype.setEditable=function(){if(!this.setEditMode){var a=this;a.isPolygon=!1,a.asynchronous=!1,e.registerEditableShape(a),a.setEditMode=b,a.setHighlighted=function(a){this._highlighted&&this._highlighted==a||this._editMode!==!0&&(this._highlighted=a,a?(e.setHighlighted(this),this.setWidth(2*this.getWidth())):this.setWidth(this.getWidth()/2))},a.setEditMode(!1),c.enhanceWithListeners(a),a.addListener("onEdited",function(){e.trigger("edited",{id:a.id,positions:a.getPositions()})})}}},b.prototype.muteHandlers=function(a){this._handlersMuted=a},b.prototype.startDrawing=function(a){this.disableAllEditMode(),this.editCleanUp&&this.editCleanUp(),this.editCleanUp=a,this.muteHandlers(!0)},b.prototype.stopDrawing=function(){this.editCleanUp&&(this.editCleanUp(),this.editCleanUp=null),this.muteHandlers(!1)},b.prototype.startDrawingPolyline=function(){var a=c.copyOptions({},d.defaultPolylineOptions());this.startDrawingPolyshape(!1,a)},b.prototype.startDrawingPolyshape=function(b,c){this.startDrawing(function(){n.destroy(),m.remove(),j.remove(e),f.trigger(b?"polygonCreateCancel":"polylineCreateCancel")});var e,f=this,i=f._scene,j=i.primitives,k=b?3:2;e=b?new Cesium.Polygon(c):new h(d.defaultPolylineOptions()),e.asynchronous=!1,j.add(e);var l=[],m=new g(this,d.defaultBillboard),n=new Cesium.ScreenSpaceEventHandler(i.canvas);n.setInputAction(function(b){if(null!=b.position){var c=i.camera.pickEllipsoid(b.position,a);c&&(0==l.length&&(l.push(c.clone()),m.addBillboard(l[0])),l.length>=k&&e.setPositions(l),l.push(c),m.addBillboard(c))}},Cesium.ScreenSpaceEventType.LEFT_CLICK),n.setInputAction(function(b){var c=b.endPosition;if(null!=c)if(0==l.length);else{var d=i.camera.pickEllipsoid(c,a);d&&(l.pop(),d.y+=1+Math.random(),l.push(d),l.length>=k&&e.setPositions(l))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),n.setInputAction(function(c){var e=c.position;if(null!=e){if(l.length<k+2)return;var g=i.camera.pickEllipsoid(e,a);if(g){f.stopDrawing(),f.trigger(l.splice(l.length-2));var m=f.nextID();if(b){var n=new PolygonPrimitive({id:m,positions:l});j.add(n),n.setEditable(),f.primitivesCache[m]=n,f.trigger("polygonCreated",{id:m,positions:l})}else{var o=d.defaultPolylineOptions(),p=new h(o);p.id=m,p.positions=l,j.add(p),p.setEditable(),f.primitivesCache[m]=p,f.trigger("polylineCreated",{id:m,info:{positions:l,width:o.width,color:o.material.uniforms.color}})}}}},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},b.prototype.startDrawingLabel=function(){var b=this;b.startDrawing(function(){if(i.destroy(),b.enableMouseEvent(),c){if(c.value){var a=b.nextID(),j=new f({id:a,text:c.value,position:e});h.add(j.getPrimitive()),b.primitivesCache[a]=j,j.setEditable(),b.trigger("labelCreated",{id:a,text:c.value,position:e,fillColor:d.defaultLabelOptions().fillColor})}else b.trigger("labelCreateCancel");g.canvas.parentNode.removeChild(c)}else b.trigger("labelCreateCancel")});var c,e,g=b._scene,h=g.primitives,i=new Cesium.ScreenSpaceEventHandler(g.canvas);i.setInputAction(function(d){if(null!=d.position){var f=g.camera.pickEllipsoid(d.position,a);if(f){if(c)return;b.disableMouseEvent(),e=f,c=document.createElement("input"),c.type="text",c.placeholder="输入名称",c.style.position="absolute",c.style.height="21px",c.style.width="125px",c.style.top=d.position.y-17+"px",c.style.left=d.position.x-2+"px",c.style.backgroundColor="rgba(0,0,0,0)",c.style.outline="none",c.style.border="none",c.style.borderBottom="1px solid #fff",c.style.color="white",c.style.fontSize="14px",g.canvas.parentNode.insertBefore(c),c.addEventListener("keyup",function(a){switch(a.keyCode){case 13:b.stopDrawing();break;case 27:b.stopDrawing()}}),c.focus()}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},b.prototype.startMeasureDistance=function(){var b=this;b.startDrawing(function(){f.remove(l),f.remove(j),k.remove()}),b.muteHandlers(!1);var e=b._scene,f=e.primitives,i=new Cesium.ScreenSpaceEventHandler(e.canvas),j=new h(d.defaultMeasurePolylineOptions),k=new g(this,d.defaultBillboard),l=new Cesium.LabelCollection,m=l.add({fillColor:Cesium.Color.fromCssColorString("#fff"),show:!0,font:"12px Helvetica"});j.asynchronous=!1,f.add(j),f.add(l);var n=[],i=new Cesium.ScreenSpaceEventHandler(e.canvas),o={onOutHandlers:{onMouseOn:function(a){var b=n[a],d=n[a-1];a>0&&(a>=n.length-1?(m.setPosition(b),m.setText("共:"+c.getTotalDistance(n,"km"))):(m.setPosition(b),m.setText(c.calDistance(d.x,d.y,b.x,b.y,"km")+" 共:"+c.getTotalDistance(n.slice(0,a+1),"km"))))}}};i.setInputAction(function(b){if(null!=b.position){var c=e.camera.pickEllipsoid(b.position,a);if(c)if(k.addBillboard(c,o),k.setOnTop(),n.push(c),n.length>=2)j.setPositions(n);else{var d=l.add({fillColor:Cesium.Color.fromCssColorString("#fff"),show:!0,font:"12px Helvetica"});d.setText("起点"),d.setPosition(c)}}},Cesium.ScreenSpaceEventType.LEFT_CLICK),i.setInputAction(function(b){var d=b.endPosition;if(null!=d){var f=e.camera.pickEllipsoid(d,a);if(document.body.style.cursor=f?"crosshair":"default",n.length>0&&f){var g=n[n.length-1];m.setText(c.calDistance(f.x,f.y,g.x,g.y,"km")),m.setPosition(f),f.y+=1+Math.random(),n.length>=1&&j.setPositions(n.concat(f))}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(function(){document.body.style.cursor="default",i.destroy(),n.splice(n.length-1),b.trigger("measureDistanceFinished")},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},b.prototype.setObjectToEditMode=function(a){var b=this.primitivesCache[a];b&&(b.setEditMode?b.setEditMode(!0):b instanceof f&&b.label.setEditMode(!0))},b.prototype.removeObject=function(a){var b=this.primitivesCache[a];if(b){this.disableAllEditMode();var c=this._scene,d=c.primitives;d.remove(b instanceof f?b.getPrimitive():b),delete this.primitivesCache[a]}},b.prototype.flyToObj=function(a){var b=this.primitivesCache[a];if(b&&b.getExtent){var c=b.getExtent();c&&this.flyToExtent(c)}},b.prototype.flyToExtent=function(a){var b=Cesium.CameraFlightPath.createAnimationExtent(this._scene,{destination:a,duration:1e3});this._scene.animations.add(b)},b.prototype.drawOrShowObject=function(a){var b=this.primitivesCache[a.id];if(b)b instanceof f?b.getPrimitive().get(0).setShow(!0):b.show=!0;else{var c=this._scene,e=c.primitives;if("polyline"===a.type){var g=new h(d.createPolyline(a.cesiumInfos.width,a.cesiumInfos.color));g.id=a.id,g.positions=a.cesiumInfos.positions,e.add(g),g.setEditable(),this.primitivesCache[a.id]=g}else if("label"===a.type){var i=new f({id:a.id,text:a.cesiumInfos.text,position:a.cesiumInfos.position,fillColor:a.cesiumInfos.fillColor});e.add(i.getPrimitive()),i.setEditable(),this.primitivesCache[a.id]=i}}},b.prototype.hideObject=function(a){var b=this.primitivesCache[a];b&&(b instanceof f?b.getPrimitive().get(0).setShow(!1):b.show=!1)},b}();b.cesiumDrawer=new i}(document,window);
//# sourceMappingURL=iEarth.cesium.map